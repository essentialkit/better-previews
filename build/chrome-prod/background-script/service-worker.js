var IS_DEV_BUILD=false;
(()=>{var re=Object.create;var q=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var oe=Object.getPrototypeOf,ce=Object.prototype.hasOwnProperty;var ge=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),le=(s,e)=>{for(var n in e)q(s,n,{get:e[n],enumerable:!0})},me=(s,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let m of ae(e))!ce.call(s,m)&&m!==n&&q(s,m,{get:()=>e[m],enumerable:!(a=ie(e,m))||a.enumerable});return s};var ue=(s,e,n)=>(n=s!=null?re(oe(s)):{},me(e||!s||!s.__esModule?q(n,"default",{value:s,enumerable:!0}):n,s));var te=ge((X,ee)=>{(function(s,e){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],e);else if(typeof X<"u")e(ee);else{var n={exports:{}};e(n),s.browser=n.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:X,function(s){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let e="The message port closed before a response was received.",n=a=>{let m={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(m).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class A extends WeakMap{constructor(r,o=void 0){super(o),this.createItem=r}get(r){return this.has(r)||this.set(r,this.createItem(r)),super.get(r)}}let b=t=>t&&typeof t=="object"&&typeof t.then=="function",v=(t,r)=>(...o)=>{a.runtime.lastError?t.reject(new Error(a.runtime.lastError.message)):r.singleCallbackArg||o.length<=1&&r.singleCallbackArg!==!1?t.resolve(o[0]):t.resolve(o)},S=t=>t==1?"argument":"arguments",T=(t,r)=>function(c,..._){if(_.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${S(r.minArgs)} for ${t}(), got ${_.length}`);if(_.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${S(r.maxArgs)} for ${t}(), got ${_.length}`);return new Promise((d,p)=>{if(r.fallbackToNoCallback)try{c[t](..._,v({resolve:d,reject:p},r))}catch(l){console.warn(`${t} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,l),c[t](..._),r.fallbackToNoCallback=!1,r.noCallback=!0,d()}else r.noCallback?(c[t](..._),d()):c[t](..._,v({resolve:d,reject:p},r))})},O=(t,r,o)=>new Proxy(r,{apply(c,_,d){return o.call(_,t,...d)}}),y=Function.call.bind(Object.prototype.hasOwnProperty),P=(t,r={},o={})=>{let c=Object.create(null),_={has(p,l){return l in t||l in c},get(p,l,x){if(l in c)return c[l];if(!(l in t))return;let h=t[l];if(typeof h=="function")if(typeof r[l]=="function")h=O(t,t[l],r[l]);else if(y(o,l)){let L=T(l,o[l]);h=O(t,t[l],L)}else h=h.bind(t);else if(typeof h=="object"&&h!==null&&(y(r,l)||y(o,l)))h=P(h,r[l],o[l]);else if(y(o,"*"))h=P(h,r[l],o["*"]);else return Object.defineProperty(c,l,{configurable:!0,enumerable:!0,get(){return t[l]},set(L){t[l]=L}}),h;return c[l]=h,h},set(p,l,x,h){return l in c?c[l]=x:t[l]=x,!0},defineProperty(p,l,x){return Reflect.defineProperty(c,l,x)},deleteProperty(p,l){return Reflect.deleteProperty(c,l)}},d=Object.create(t);return new Proxy(d,_)},k=t=>({addListener(r,o,...c){r.addListener(t.get(o),...c)},hasListener(r,o){return r.hasListener(t.get(o))},removeListener(r,o){r.removeListener(t.get(o))}}),F=new A(t=>typeof t!="function"?t:function(o){let c=P(o,{},{getContent:{minArgs:0,maxArgs:0}});t(c)}),U=new A(t=>typeof t!="function"?t:function(o,c,_){let d=!1,p,l=new Promise(C=>{p=function(w){d=!0,C(w)}}),x;try{x=t(o,c,p)}catch(C){x=Promise.reject(C)}let h=x!==!0&&b(x);if(x!==!0&&!h&&!d)return!1;let L=C=>{C.then(w=>{_(w)},w=>{let W;w&&(w instanceof Error||typeof w.message=="string")?W=w.message:W="An unexpected error occurred",_({__mozWebExtensionPolyfillReject__:!0,message:W})}).catch(w=>{console.error("Failed to send onMessage rejected reply",w)})};return L(h?x:l),!0}),B=({reject:t,resolve:r},o)=>{a.runtime.lastError?a.runtime.lastError.message===e?r():t(new Error(a.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?t(new Error(o.message)):r(o)},I=(t,r,o,...c)=>{if(c.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${S(r.minArgs)} for ${t}(), got ${c.length}`);if(c.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${S(r.maxArgs)} for ${t}(), got ${c.length}`);return new Promise((_,d)=>{let p=B.bind(null,{resolve:_,reject:d});c.push(p),o.sendMessage(...c)})},G={devtools:{network:{onRequestFinished:k(F)}},runtime:{onMessage:k(U),onMessageExternal:k(U),sendMessage:I.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:I.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},i={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return m.privacy={network:{"*":i},services:{"*":i},websites:{"*":i}},P(a,G,m)};s.exports=n(chrome)}else s.exports=globalThis.browser})});var N={name:"__MSG_@appName__",description:"__MSG_@appDesc__",short_name:"__MSG_@appShortName_",homepage_url:"https://betterpreviews.com/",__package_name__:"search-preview","__comment:version__":"Firefox does not support leading zeros in versions",version:"24.04.12",__sentry_dsn__:"https://bf0a1e40a1784502aad701a201efdf08@o526305.ingest.sentry.io/4504743520436224",__measurement_id__:"G-XN737SN9S2",__ga_api_secret__:"zigXBV_3TjyIjkXuSPjo8w",manifest_version:3,default_locale:"en",author:"Justice Ogbonna",permissions:["storage","declarativeNetRequest","contextMenus","cookies","activeTab"],declarative_net_request:{rule_resources:[{id:"ruleset_1",enabled:!0,path:"assets/rules.json"}]},host_permissions:["*://*/*"],action:{default_icon:{"16":"assets/logo-16x16.png","24":"assets/logo-24x24.png","32":"assets/logo-32x32.png"},default_title:"Search Preview"},icons:{"16":"assets/logo-16x16.png","32":"assets/logo-32x32.png","48":"assets/logo-48x48.png","128":"assets/logo-128x128.png"},content_scripts:[{matches:["http://*/*","https://*/*"],all_frames:!0,js:["content-script/content-script.js"],css:["content-script/content-script.css"]}],background:{__chrome__service_worker:"background-script/service-worker.js",__firefox__scripts:["background-script/service-worker.js"]},side_panel:{default_path:"sidepanel/side-panel.html"},options_page:"options-page/options.html",web_accessible_resources:[{resources:["assets/logo-24x24.png"],matches:["<all_urls>"]},{resources:["options-page/options.html"],matches:["<all_urls>"]},{resources:["welcome/my-element.js"],matches:["<all_urls>"]},{resources:["content-script/floatie/tooltip.js"],matches:["<all_urls>"]}],__firefox__key:"",__firefox__browser_specific_settings:{gecko:{id:"search-preview@essentialkit.org"}}};async function $(){let{sessionData:s}=await chrome.storage.session.get("sessionData"),e=Date.now();return s&&s.timestamp&&((e-s.timestamp)/6e4>30?s=null:(s.timestamp=e,await chrome.storage.session.set({sessionData:s}))),s||(s={session_id:e.toString(),timestamp:e.toString()},await chrome.storage.session.set({sessionData:s})),s.session_id}var de="https://www.google-analytics.com/mp/collect",he="https://www.google-analytics.com/debug/mp/collect",Ae=N.__measurement_id__,pe=N.__ga_api_secret__,fe=100,H=class{constructor(){this.debug=IS_DEV_BUILD}async getOrCreateClientId(){let{clientId:e}=await chrome.storage.local.get("clientId");return e||(e=self.crypto.randomUUID(),await chrome.storage.local.set({clientId:e})),e}async getSessionId(){try{return $()}catch{return new Promise(n=>{chrome.runtime.sendMessage("get_or_create_session_id",a=>{n(a)})})}}async fireEvent(e,n={}){n.session_id||(n.session_id=await this.getSessionId()),n.engagement_time_msec||(n.engagement_time_msec=fe);try{let a=await fetch(`${this.debug?he:de}?measurement_id=${Ae}&api_secret=${pe}`,{method:"POST",body:JSON.stringify({client_id:await this.getOrCreateClientId(),events:[{name:e,params:n}]})});if(!this.debug)return;console.log(await a.text())}catch(a){console.error("Google Analytics request failed with an exception",a)}}async firePageViewEvent(e,n,a={}){return this.fireEvent("page_view",{page_title:e,page_location:n,...a})}async fireErrorEvent(e,n={}){return this.fireEvent("extension_error",{...e,...n})}},M=new H;var D="feedback_data",R="install_time_ms",Z="successful_interactions",V=class{constructor(){this.storageService=chrome.storage.sync}put(e,n){if(n==null)return Promise.reject("Attempting to save a null value");if(!e)return Promise.reject("Attempting to use a null key");let a={};return a[e]=n,this.storageService.set(a)}async get(e){return(await this.storageService.get(e))[e]}getAll(){return this.storageService.get(null)}async getAndUpdate(e,n){let a=await this.get(e);return this.put(e,await n(a))}},f=new V;var xe="https://forms.gle/PdZ9U61QawXSa4qH8",we=chrome.runtime.getURL("welcome/welcome.html"),be=s=>{f.put(R,Date.now()),s.reason==="install"&&(chrome.tabs.create({url:we,active:!0}),M.fireEvent("install",{reaason:s.reason})),chrome.runtime.setUninstallURL(xe,()=>{chrome.runtime.lastError&&console.error("Error setting uninstall URL",chrome.runtime.lastError)})};chrome.runtime.onInstalled.addListener(be);var ye=N.__package_name__,E=class{constructor(e){this.tag="";this.debug=(...e)=>this.internalLog(3,...e);this.log=(...e)=>this.internalLog(2,...e);this.warn=(...e)=>this.internalLog(1,...e);this.error=(...e)=>this.internalLog(0,...e);this.tag=ye+"."+(typeof e=="string"?e:e.constructor.name),this.listenForBgLogs()}listenForBgLogs(){chrome?.runtime.onMessage.addListener((e,n)=>{n.id!==chrome.runtime.id||e.action!="log"||this.internalLogTagOverride(e.data.level,e.data.tag,...e.data.messages)})}internalLog(e,...n){this.internalLogTagOverride(e,this.tag,...n)}internalLogTagOverride(e,n,...a){let m=new Date(Date.now()),A=["%c%s %s","color: blue",`[${m.getHours()}:${m.getMinutes()}:${m.getSeconds()}]`,n,...a];if(IS_DEV_BUILD)switch(e){case 3:console.debug(...A);break;case 1:console.warn(...A);break;case 2:console.log(...A);break;case 0:console.error(...A);break}else{switch(e){case 0:M.fireErrorEvent(a[0],{...a});break}return}}};var Y=class{constructor(){this.logger=new E(this);this.RELOAD_ACTION={menu:{id:"reload-extension",title:"Reload Extension",visible:!0,contexts:["action"]},handler:e=>{chrome.runtime.reload()}};this.CLEAR_STORAGE={menu:{id:"clear-storage",title:"Clear Storage",visible:!0,contexts:["action"]},handler:e=>{chrome.storage.sync.clear(),chrome.storage.local.clear()}};this.PRINT_STORAGE={menu:{id:"print-storage",title:"Print Storage",visible:!0,contexts:["action"]},handler:async e=>{this.logger.log("Storage contents:",await f.getAll())}};this.PREVIEW_ACTION={menu:{id:"show-preview",title:"Preview Link",visible:!0,contexts:["link"]},handler:e=>{if(!e.linkUrl){this.logger.warn("No linkurl",e);return}this.sendMessage({action:"preview",data:e.linkUrl})}};this.SEARCH_ACTION={menu:{id:"show-search",title:"Preview Search Results",visible:!0,contexts:["selection"]},handler:e=>{if(!e.selectionText){this.logger.warn("No selection",e);return}this.sendMessage({action:"search",data:e.selectionText})}};this.DISABLE_ON_SITE={menu:{id:"disable-on-site",title:"Disable previews on this site",visible:!0,contexts:["action"]},handler:e=>{f.getAndUpdate("blocked-sites",async n=>{let a;try{let b=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0].url??"";a=new URL(b)}catch(A){return this.logger.debug("Unable to parse url:",A),n}return a?n?n+`
`+a.hostname:a.hostname:(this.logger.debug("URL is null"),n)})}};this.browserActionContextMenu=[this.PREVIEW_ACTION,this.SEARCH_ACTION,this.DISABLE_ON_SITE];this.init=()=>{if(IS_DEV_BUILD&&this.browserActionContextMenu.push(this.RELOAD_ACTION,this.CLEAR_STORAGE,this.PRINT_STORAGE),!chrome||!chrome.contextMenus){this.logger.warn("No access to chrome.contextMenus");return}chrome.contextMenus.removeAll(),this.browserActionContextMenu.forEach(e=>chrome.contextMenus.create(e.menu)),chrome.contextMenus.onClicked.addListener(this.onClick)};this.onClick=(e,n)=>{let a=this.browserActionContextMenu.find(m=>m.menu.id===e.menuItemId);a?(M.fireEvent("context_menu_click",{menu_id:e.menuItemId}),a.handler(e,n)):this.logger.error("Unable to find menu item: ",e)}}sendMessage(e){chrome.tabs.query({active:!0,currentWindow:!0},n=>{chrome.tabs.sendMessage(n[0].id,e,a=>{this.logger.debug("ack:",a)})})}};new Y().init();chrome.tabs.onUpdated.addListener((s,e,n)=>{chrome.tabs.get(s,a=>J(a.url))});chrome.tabs.onActivated.addListener(s=>{chrome.tabs.get(s.tabId,e=>J(e.url))});var J=s=>{let e=!s||!s.trim()||s.startsWith("chrome-extension://")||s.startsWith("chrome://newtab/")||s.startsWith("https://chrome.google.com/webstore")?"assets/logo-gray-128x128.png":"assets/logo-128x128.png";chrome.action.setIcon({path:chrome.runtime.getURL(e)})};var K=class{constructor(){this.DAY_MS=864e5;this.logger=new E(this)}async runFeedbackCheck(e){if(await this.shouldRequestFeedback(e)){let a={status:"eligible",timestamp:Date.now()};f.put(D,a);return}if((await f.get(D))?.status=="eligible"){let a={status:"ineligible",timestamp:Date.now()};f.put(D,a);return}}async shouldRequestFeedback(e){let n=!await this.isIncognito(e),a=await this.isSignedInToGoogle(),m=await this.getDaysSinceInstallation()>7,A=await this.getSuccessCount()>=30,b=await this.isEligibleForReissue(),v=n&&a&&m&&A&&b;return this.logger.debug(`isEligible: ${v}. Based on 
      isNormalWindow: ${n}, 
      isSignedIn: ${a}, 
      isAgedInstallation: ${m}, 
      hasSufficientSuccessfulInteractions: ${A}, 
      isEligibleForReissue: ${b}`),v}async isIncognito(e){if(e&&e.incognito)return Promise.resolve(!0);let a=(await chrome.tabs.query({active:!0,currentWindow:!0})).find(m=>m.incognito);return Promise.resolve(a!==void 0)}async getSuccessCount(){let e=await f.get(Z);return e?Promise.resolve(e.length):Promise.resolve(0)}isSignedInToGoogle(){return new Promise(e=>{chrome.cookies.get({url:"https://accounts.google.com",name:"LSID"},n=>{e(!!n)})})}async getDaysSinceInstallation(){let e=await f.get(R);if(!e)return await f.put(R,Date.now()),Promise.resolve(0);let n=Date.now()-e,a=Math.ceil(n/(1e3*60*60*24));return Promise.resolve(a)}async isEligibleForReissue(){let e=await f.get(D);return e&&e.status==="honored"?Promise.resolve(!1):Promise.resolve(!0)}},Q=new K;chrome.tabs.onActivated.addListener(s=>{chrome.tabs.get(s.tabId,e=>Q.runFeedbackCheck(e))});chrome.tabs.onUpdated.addListener((s,e,n)=>{chrome.tabs.get(s,a=>Q.runFeedbackCheck(a))});var u=ue(te(),1);typeof window<"u"&&window.addEventListener("message",s=>{s.origin==="https://extensionpay.com"&&s.source==window&&(s.data==="fetch-user"||s.data==="trial-start")&&u.runtime.sendMessage(s.data)},!1);function ve(s){let e="https://extensionpay.com",n=`${e}/extension/${s}`;function a(i){return new Promise(t=>setTimeout(t,i))}async function m(i){try{return await u.storage.sync.get(i)}catch{return await u.storage.local.get(i)}}async function A(i){try{return await u.storage.sync.set(i)}catch{return await u.storage.local.set(i)}}u.management&&u.management.getSelf().then(async i=>{if(!i.permissions.includes("storage")){var t=i.hostPermissions.concat(i.permissions);throw`ExtPay Setup Error: please include the "storage" permission in manifest.json["permissions"] or else ExtensionPay won't work correctly.

You can copy and paste this to your manifest.json file to fix this error:

"permissions": [
    ${t.map(r=>`"    ${r}"`).join(`,
`)}${t.length>0?",":""}
    "storage"
]
`}}),m(["extensionpay_installed_at","extensionpay_user"]).then(async i=>{if(i.extensionpay_installed_at)return;let t=i.extensionpay_user,r=t?t.installedAt:new Date().toISOString();await A({extensionpay_installed_at:r})});let b=[],v=[];async function S(){var i={},t;if(u.management)t=await u.management.getSelf();else if(u.runtime)t=await u.runtime.sendMessage("extpay-extinfo"),t||(t={installType:!("update_url"in u.runtime.getManifest())?"development":"normal"});else throw"ExtPay needs to be run in a browser extension context";t.installType=="development"&&(i.development=!0);let r=await fetch(`${n}/api/new-key`,{method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},body:JSON.stringify(i)});if(!r.ok)throw r.status,`${e}/home`;let o=await r.json();return await A({extensionpay_api_key:o}),o}async function T(){let i=await m(["extensionpay_api_key"]);return i.extensionpay_api_key?i.extensionpay_api_key:null}let O=/^\d\d\d\d-\d\d-\d\dT/;async function y(){var i=await m(["extensionpay_user","extensionpay_installed_at"]);let t=await T();if(!t)return{paid:!1,paidAt:null,installedAt:i.extensionpay_installed_at?new Date(i.extensionpay_installed_at):new Date,trialStartedAt:null};let r=await fetch(`${n}/api/user?api_key=${t}`,{method:"GET",headers:{Accept:"application/json"}});if(!r.ok)throw"ExtPay error while fetching user: "+await r.text();let o=await r.json(),c={};for(var[_,d]of Object.entries(o))d&&d.match&&d.match(O)&&(d=new Date(d)),c[_]=d;return c.installedAt=new Date(i.extensionpay_installed_at),c.paidAt&&(!i.extensionpay_user||i.extensionpay_user&&!i.extensionpay_user.paidAt)&&b.forEach(p=>p(c)),c.trialStartedAt&&(!i.extensionpay_user||i.extensionpay_user&&!i.extensionpay_user.trialStartedAt)&&v.forEach(p=>p(c)),await A({extensionpay_user:o}),c}async function P(){var i=await T();return i||(i=await S()),`${n}?api_key=${i}`}async function k(i,t,r){if(u.windows&&u.windows.create){let o=await u.windows.getCurrent(),c=Math.round((o.width-t)*.5+o.left),_=Math.round((o.height-r)*.5+o.top);try{u.windows.create({url:i,type:"popup",focused:!0,width:t,height:r,left:c,top:_})}catch{u.windows.create({url:i,type:"popup",width:t,height:r,left:c,top:_})}}else window.open(i,null,`toolbar=no,location=no,directories=no,status=no,menubar=no,width=${t},height=${r},left=450`)}async function F(){let i=await P();k(i,500,800)}async function U(i){var t=await T();t||(t=await S());var r=`${n}/trial?api_key=${t}`;i&&(r+=`&period=${i}`),k(r,500,650)}async function B(){var i=await T();i||(i=await S());let t=`${n}/reactivate?api_key=${i}`;k(t,500,800)}var I=!1;async function G(){if(!I){I=!0;for(var i=await y(),t=0;t<2*60;++t){if(i.paidAt)return I=!1,i;await a(1e3),i=await y()}I=!1}}return{getUser:function(){return y()},onPaid:{addListener:function(i){let t=`"content_scripts": [
                {
            "matches": ["${e}/*"],
            "js": ["ExtPay.js"],
            "run_at": "document_start"
        }]`,r=u.runtime.getManifest();if(!r.content_scripts)throw`ExtPay setup error: To use the onPaid callback handler, please include ExtPay as a content script in your manifest.json. You can copy the example below into your manifest.json or check the docs: https://github.com/Glench/ExtPay#2-configure-your-manifestjson

        ${t}`;let o=r.content_scripts.find(c=>c.matches.includes(e.replace(":3000","")+"/*"));if(o){if(!o.run_at||o.run_at!=="document_start")throw`ExtPay setup error: To use the onPaid callback handler, please make sure the ExtPay content script in your manifest.json runs at document start. You can copy the example below into your manifest.json or check the docs: https://github.com/Glench/ExtPay#2-configure-your-manifestjson

        ${t}`}else throw`ExtPay setup error: To use the onPaid callback handler, please include ExtPay as a content script in your manifest.json matching "${e}/*". You can copy the example below into your manifest.json or check the docs: https://github.com/Glench/ExtPay#2-configure-your-manifestjson

        ${t}`;b.push(i)}},openPaymentPage:F,openTrialPage:U,openLoginPage:B,onTrialStarted:{addListener:function(i){v.push(i)}},startBackground:function(){u.runtime.onMessage.addListener(function(i,t,r){if(console.log("service worker got message! Here it is:",i),i=="fetch-user")G();else if(i=="trial-start")y();else if(i=="extpay-extinfo"&&u.management)return u.management.getSelf()})}}}var se=ve;var j={};le(j,{"@appDesc":()=>ke,"@appName":()=>Se,"@appShortName":()=>Ee,"@testMarkup":()=>Ie,Automatically_Hide_Previews:()=>He,Baidu_Search:()=>Ne,Bing_Search:()=>Me,By_default__the_version_of_Google_search_used_is_always_signed_out_for_privacy_and_security_reasons__Though_this_may_result_in_always_seeing_sign_in_prompts_:()=>et,Close_on_Escape_Key:()=>We,Disable_Previews_on_this_site:()=>tt,Disabled_on_Websites:()=>nt,Displays_the_view_in_Chrome_Side_Panel_instead_of_a_floating_box_:()=>Ke,Extension_will_not_run_on_these_sites__you_can_disable_a_site_by_adding_to_this_list_:()=>rt,For_websites_that___really___do_not_want_to_be_previewed__e_g__stackoverflow_com__this_forces_a_preview__Nerd_alert__this_is_a_frame_busting_buster_:()=>Je,Google_Search:()=>Le,Hides_the_preview_panel_when_you_scroll_away_or_interact_with_the_main_page_:()=>Ve,Left_side:()=>Ge,Panel_Position:()=>je,Preview_Height____:()=>Ue,Preview_Width____:()=>Re,Preview_in_Side_Panel:()=>Ye,Preview_on_Hover_Delay:()=>Xe,Report_an_Issue:()=>ct,Right_side:()=>Be,Search__amp__Link_Preview_Options:()=>at,Search_engine:()=>Te,Show_Sample_Preview:()=>ot,Successfully_updated_settings:()=>it,The_detail_information_about_the_checkbox_here_:()=>st,The_height_of_the_preview_panel_relative_to_the_page_:()=>$e,The_search_engine_that_would_be_used_for_inline_search_previews_:()=>Pe,The_side_of_the_page_in_which_to_display_the_preview_:()=>Fe,The_width_of_the_preview_panel_relative_to_the_page_:()=>Oe,Use_the_ESC__escape__key_to_close_the_preview_panel_:()=>qe,When_automatic_preview_on_hover_is_enabled__this_is_the_delay_before_the_preview_is_shown_:()=>ze,Yahoo_Search:()=>Ce,Yandex_Search:()=>De,_Advanced__Disable_Incognito_Google:()=>Qe,_Advanced__Force_Preview:()=>Ze,default:()=>gt});var Se={message:"Search & Link Preview",description:"The name of the extension"},Ee={message:"Link Previews",description:"The short-version name of the extension name"},ke={message:"See previews of links and instantly performs searches on the same page using this previewer instead of opening new tabs",description:"A description of its function"},Ie={message:"<div><p>Hello world</p>This is the <strong>language</strong> of the web</div>"},Te={message:"Search engine"},Pe={message:"The search engine that would be used for inline search previews."},Le={message:"Google Search"},Me={message:"Bing Search"},Ce={message:"Yahoo Search"},Ne={message:"Baidu Search"},De={message:"Yandex Search"},Re={message:"Preview Width (%)"},Oe={message:"The width of the preview panel relative to the page."},Ue={message:"Preview Height (%)"},$e={message:"The height of the preview panel relative to the page."},je={message:"Panel Position"},Fe={message:"The side of the page in which to display the preview."},Be={message:"Right side"},Ge={message:"Left side"},We={message:"Close on Escape Key"},qe={message:"Use the ESC (escape) key to close the preview panel."},He={message:"Automatically Hide Previews"},Ve={message:"Hides the preview panel when you scroll away or interact with the main page."},Ye={message:"Preview in Side Panel"},Ke={message:"Displays the view in Chrome Side Panel instead of a floating box."},Xe={message:"Preview-on-Hover Delay"},ze={message:"When automatic preview on hover is enabled, this is the delay before the preview is shown."},Ze={message:"[Advanced] Force Preview"},Je={message:"For websites that **really** do not want to be previewed (e.g. stackoverflow.com) this forces a preview. Nerd alert: this is a frame-busting buster."},Qe={message:"[Advanced] Disable Incognito Google"},et={message:"By default, the version of Google search used is always signed-out for privacy and security reasons. Though this may result in always seeing sign-in prompts."},tt={message:"Disable Previews on this site"},st={message:"The detail information about the checkbox here."},nt={message:"Disabled on Websites"},rt={message:"Extension will not run on these sites, you can disable a site by adding to this list."},it={message:"Successfully updated settings"},at={message:"Search &amp; Link Preview Options"},ot={message:"Show Sample Preview"},ct={message:"Report an Issue"},gt={"@appName":Se,"@appShortName":Ee,"@appDesc":ke,"@testMarkup":Ie,Search_engine:Te,The_search_engine_that_would_be_used_for_inline_search_previews_:Pe,Google_Search:Le,Bing_Search:Me,Yahoo_Search:Ce,Baidu_Search:Ne,Yandex_Search:De,Preview_Width____:Re,The_width_of_the_preview_panel_relative_to_the_page_:Oe,Preview_Height____:Ue,The_height_of_the_preview_panel_relative_to_the_page_:$e,Panel_Position:je,The_side_of_the_page_in_which_to_display_the_preview_:Fe,Right_side:Be,Left_side:Ge,Close_on_Escape_Key:We,Use_the_ESC__escape__key_to_close_the_preview_panel_:qe,Automatically_Hide_Previews:He,Hides_the_preview_panel_when_you_scroll_away_or_interact_with_the_main_page_:Ve,Preview_in_Side_Panel:Ye,Displays_the_view_in_Chrome_Side_Panel_instead_of_a_floating_box_:Ke,Preview_on_Hover_Delay:Xe,When_automatic_preview_on_hover_is_enabled__this_is_the_delay_before_the_preview_is_shown_:ze,_Advanced__Force_Preview:Ze,For_websites_that___really___do_not_want_to_be_previewed__e_g__stackoverflow_com__this_forces_a_preview__Nerd_alert__this_is_a_frame_busting_buster_:Je,_Advanced__Disable_Incognito_Google:Qe,By_default__the_version_of_Google_search_used_is_always_signed_out_for_privacy_and_security_reasons__Though_this_may_result_in_always_seeing_sign_in_prompts_:et,Disable_Previews_on_this_site:tt,The_detail_information_about_the_checkbox_here_:st,Disabled_on_Websites:nt,Extension_will_not_run_on_these_sites__you_can_disable_a_site_by_adding_to_this_list_:rt,Successfully_updated_settings:it,Search__amp__Link_Preview_Options:at,Show_Sample_Preview:ot,Report_an_Issue:ct};var z=new E("i18n");function lt(s){let e=/^[a-zA-Z0-9_]+$/;return s.split("").map(n=>e.test(n)?n:"_").join("")}var mt=s=>{if(!s)return z.error("A valid key is required for i18n, got",s),s;let e=s.startsWith("@")?s:lt(s);if(chrome?.i18n&&chrome.i18n.getMessage(e)!=="")return chrome.i18n.getMessage(e);z.warn("chrome.i18n is not available in the current context, falling back to en-US"),Object.keys(j).forEach(n=>{});for(let[n,a]of Object.entries(j))if(n===e)return a.message;return z.error("No translation available for key:",s),s},ne=mt("@@extension_id");var ut=se(ne);ut.startBackground();var _t=(s,e,n)=>{if(!e.id||e.id!==chrome.i18n.getMessage("@@extension_id")){console.warn("Ignoring message from unknown sender",e);return}if(console.log("Received message: ",s," from: ",e),s==="get_or_create_session_id")return $().then(a=>{console.log("Sending session Id",a),n(a)}),!0;if(s==="open_options_page"){chrome.runtime.openOptionsPage(()=>{console.log("Options page opened")});return}chrome.tabs.query({active:!0,currentWindow:!0},a=>{if(a.length==0){console.error("Unexpected state: No active tab");return}chrome.tabs.sendMessage(a[0].id,s,m=>{n(m)})})};chrome.runtime.onMessage.addListener(_t);})();
