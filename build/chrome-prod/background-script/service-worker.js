(()=>{var o=class{constructor(){this.RELOAD_ACTION={menu:{id:"reload",title:"Reload Extension",visible:!0,contexts:["action"]},handler:e=>{chrome.runtime.reload()}};this.PREVIEW_ACTION={menu:{id:"show-preview",title:"Preview Link",visible:!0,contexts:["link"]},handler:e=>{if(!e.linkUrl){console.warn("No linkurl",e);return}this.sendMessage({action:"preview",data:e.linkUrl})}};this.SEARCH_ACTION={menu:{id:"show-search",title:"Preview Search Results",visible:!0,contexts:["selection"]},handler:e=>{if(!e.selectionText){console.warn("No selection",e);return}this.sendMessage({action:"search",data:e.selectionText})}};this.browserActionContextMenu=[this.RELOAD_ACTION,this.PREVIEW_ACTION,this.SEARCH_ACTION];this.init=()=>{if(!chrome||!chrome.contextMenus){console.warn("No access to chrome.contextMenus");return}chrome.contextMenus.removeAll(),this.browserActionContextMenu.forEach(e=>chrome.contextMenus.create(e.menu)),chrome.contextMenus.onClicked.addListener(this.onClick)};this.onClick=(e,r)=>{let t=this.browserActionContextMenu.find(s=>s.menu.id===e.menuItemId);t?t.handler(e,r):console.error("Unable to find menu item: ",e)}}sendMessage(e){chrome.tabs.query({active:!0,currentWindow:!0},r=>{chrome.tabs.sendMessage(r[0].id,e,t=>{console.debug("ack:",t)})})}};new o().init();var i="https://forms.gle/PdZ9U61QawXSa4qH8",c=chrome.runtime.getURL("welcome/welcome.html"),a=n=>{n.reason==="install"&&chrome.tabs.create({url:c,active:!0});let e=!0;n.reason==="update"&&!e&&chrome.tabs.create({url:c,active:!0}),chrome.runtime.setUninstallURL(i,()=>{chrome.runtime.lastError&&console.error("Error setting uninstall URL",chrome.runtime.lastError)})};chrome.runtime.onInstalled.addListener(a);var l=(n,e,r)=>{console.log("Received message: ",n," from: ",e),chrome.tabs.query({active:!0,currentWindow:!0},t=>{if(t.length==0){console.error("Unexpected state: No active tab");return}chrome.tabs.sendMessage(t[0].id,n,s=>{r(s)})})};chrome.runtime.onMessage.addListener(l);})();
